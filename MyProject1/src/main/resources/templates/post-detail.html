<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title th:text="${post.title}">ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸°</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* âœ… ì´ë¯¸ì§€ ì¸ë„¤ì¼ íš¨ê³¼ */
        .post-image {
            max-width: 200px;
            cursor: pointer;
            transition: transform 0.2s ease;
            border-radius: 8px;
        }
        .post-image:hover {
            transform: scale(1.05);
        }

        /* âœ… ëª¨ë‹¬ ì´ë¯¸ì§€ ë³´ê¸° ìŠ¤íƒ€ì¼ */
        .modal-img {
            width: 100%;
            border-radius: 8px;
        }
        .modal-content {
            background-color: transparent;
            border: none;
        }
        .modal-dialog {
            max-width: 900px;
        }
        .arrow-btn {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 3rem;
            color: white;
            cursor: pointer;
            user-select: none;
        }
        .arrow-left {
            left: 10px;
        }
        .arrow-right {
            right: 10px;
        }
    </style>
</head>
<body>

<!-- âœ… ë„¤ë¹„ê²Œì´ì…˜ -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/posts">ğŸ½ ë§›ì§‘ ê²Œì‹œíŒ</a>
        <div class="ms-auto d-flex align-items-center">
            <div sec:authorize="isAuthenticated()" class="d-flex align-items-center">
                <span class="text-light me-3">ğŸ‘‹ <span th:text="${#authentication.name}"></span> ë‹˜</span>
                <a href="/posts/new" class="btn btn-warning btn-sm me-2">ê¸€ì“°ê¸°</a>
                <a href="/logout" class="btn btn-outline-light btn-sm">ë¡œê·¸ì•„ì›ƒ</a>
            </div>
            <div sec:authorize="!isAuthenticated()">
                <a href="/login" class="btn btn-outline-light btn-sm me-2">ë¡œê·¸ì¸</a>
                <a href="/register" class="btn btn-outline-success btn-sm">íšŒì›ê°€ì…</a>
            </div>
        </div>
    </div>
</nav>

<!-- âœ… ë³¸ë¬¸ -->
<div class="container mt-4">
    <h2 th:text="${post.title}" class="fw-bold"></h2>
    <p class="text-muted">
        ì‘ì„±ì: <span th:text="${post.author}"></span> |
        ì‘ì„±ì¼: <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
    </p>

    <div class="border p-3 rounded bg-light mb-3" th:text="${post.content}"></div>

    <!-- âœ… ì´ë¯¸ì§€ í‘œì‹œ -->
    <div class="mt-3 d-flex flex-wrap gap-3">
        <img th:each="img, stat : ${post.imagePaths}"
             th:src="@{${img.imagePath}}"
             th:attr="data-index=${stat.index}"
             class="post-image shadow-sm"/>
    </div>

    <!-- âœ… ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼ -->
    <div class="mt-4">
        <a href="/posts" class="btn btn-secondary btn-sm">ëª©ë¡</a>
        <a th:if="${currentUser == post.author}"
           th:href="@{'/posts/' + ${post.id} + '/edit'}"
           class="btn btn-warning btn-sm">ìˆ˜ì •</a>
        <form th:if="${currentUser == post.author}"
              th:action="@{'/posts/' + ${post.id} + '/delete'}"
              method="post" style="display:inline;">
            <button class="btn btn-danger btn-sm">ì‚­ì œ</button>
        </form>
    </div>

    <hr>

    <!-- âœ… ëŒ“ê¸€ ì˜ì—­ -->
    <h5 class="fw-bold mb-3">ğŸ’¬ ëŒ“ê¸€</h5>
    <div th:if="${#lists.isEmpty(comments)}" class="text-muted">ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>

    <div th:each="comment : ${comments}" class="border p-2 rounded mb-2 bg-white">
        <strong th:text="${comment.author}"></strong>
        <p th:text="${comment.content}"></p>
        <form th:if="${currentUser == comment.author}"
              th:action="@{'/comments/' + ${comment.id} + '/delete'}"
              method="post">
            <input type="hidden" th:name="postId" th:value="${post.id}">
            <button class="btn btn-sm btn-outline-danger">ì‚­ì œ</button>
        </form>
    </div>

    <!-- âœ… ëŒ“ê¸€ ì‘ì„± í¼ -->
    <form th:action="@{'/posts/' + ${post.id} + '/comments'}" method="post" class="mt-3">
        <textarea name="content" class="form-control mb-2" rows="2" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        <button class="btn btn-primary btn-sm">ëŒ“ê¸€ ë“±ë¡</button>
    </form>
</div>

<!-- âœ… ì´ë¯¸ì§€ í™•ëŒ€ ëª¨ë‹¬ -->
<div class="modal fade" id="imageModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content text-center position-relative">
            <span class="arrow-btn arrow-left" onclick="prevImage()">&#10094;</span>
            <img id="modalImage" src="" class="modal-img"/>
            <span class="arrow-btn arrow-right" onclick="nextImage()">&#10095;</span>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const thumbnails = document.querySelectorAll(".post-image");
    const modal = new bootstrap.Modal(document.getElementById('imageModal'));
    const modalImage = document.getElementById('modalImage');
    let currentIndex = 0;

    thumbnails.forEach((thumb, index) => {
        thumb.addEventListener("click", () => {
            currentIndex = index;
            modalImage.src = thumb.src;
            modal.show();
        });
    });

    function prevImage() {
        currentIndex = (currentIndex - 1 + thumbnails.length) % thumbnails.length;
        modalImage.src = thumbnails[currentIndex].src;
    }

    function nextImage() {
        currentIndex = (currentIndex + 1) % thumbnails.length;
        modalImage.src = thumbnails[currentIndex].src;
    }

    // í‚¤ë³´ë“œë¡œë„ ì´ë™ ê°€ëŠ¥
    document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowLeft") prevImage();
        if (e.key === "ArrowRight") nextImage();
    });
</script>

</body>
</html>
