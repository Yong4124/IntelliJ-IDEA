<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <title th:text="${post.title}">게시글 상세보기</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>

<!-- ✅ 네비게이션 -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow-sm">
    <div class="container">
        <a class="navbar-brand fw-bold" href="/posts">🍽 맛집 게시판</a>
        <div class="ms-auto d-flex align-items-center">
            <!-- 로그인 상태 -->
            <div sec:authorize="isAuthenticated()" class="d-flex align-items-center">
                <span class="text-light me-3">👋 <span th:text="${#authentication.name}"></span> 님</span>
                <a href="/posts/new" class="btn btn-warning btn-sm me-2">글쓰기</a>
                <a href="/logout" class="btn btn-outline-light btn-sm">로그아웃</a>
            </div>
            <!-- 비로그인 상태 -->
            <div sec:authorize="!isAuthenticated()">
                <a href="/login" class="btn btn-outline-light btn-sm me-2">로그인</a>
                <a href="/register" class="btn btn-outline-success btn-sm">회원가입</a>
            </div>
        </div>
    </div>
</nav>

<!-- ✅ 본문 -->
<div class="container mt-4">
    <h2 th:text="${post.title}" class="fw-bold"></h2>
    <p class="text-muted">
        작성자: <span th:text="${post.author}"></span> |
        작성일: <span th:text="${#temporals.format(post.createdAt, 'yyyy-MM-dd HH:mm')}"></span>
    </p>

    <div class="border p-3 rounded bg-light mb-3" th:text="${post.content}"></div>

    <!-- ✅ 이미지 표시 -->
    <div class="mt-3">
        <div th:each="img : ${post.imagePaths}">
            <img th:src="@{${img.imagePath}}" class="img-fluid mb-2 rounded shadow-sm" style="max-width: 500px;">
        </div>
    </div>

    <!-- ✅ 수정/삭제 버튼 (작성자만 표시) -->
    <div class="mt-4">
        <a href="/posts" class="btn btn-secondary btn-sm">목록</a>

        <a th:if="${currentUser == post.author}"
           th:href="@{'/posts/' + ${post.id} + '/edit'}"
           class="btn btn-warning btn-sm">수정</a>

        <form th:if="${currentUser == post.author}"
              th:action="@{'/posts/' + ${post.id} + '/delete'}"
              method="post" style="display:inline;">
            <button class="btn btn-danger btn-sm">삭제</button>
        </form>
    </div>

    <hr>

    <!-- ✅ 댓글 영역 -->
    <h5 class="fw-bold mb-3">💬 댓글</h5>
    <div th:if="${#lists.isEmpty(comments)}" class="text-muted">아직 댓글이 없습니다.</div>

    <div th:each="comment : ${comments}" class="border p-2 rounded mb-2 bg-white">
        <strong th:text="${comment.author}"></strong>
        <p th:text="${comment.content}"></p>
        <form th:if="${currentUser == comment.author}"
              th:action="@{'/comments/' + ${comment.id} + '/delete'}"
              method="post">
            <input type="hidden" th:name="postId" th:value="${post.id}">
            <button class="btn btn-sm btn-outline-danger">삭제</button>
        </form>
    </div>

    <!-- ✅ 댓글 작성 폼 -->
    <form th:action="@{'/posts/' + ${post.id} + '/comments'}" method="post" class="mt-3">
        <textarea name="content" class="form-control mb-2" rows="2" placeholder="댓글을 입력하세요"></textarea>
        <button class="btn btn-primary btn-sm">댓글 등록</button>
    </form>
</div>

</body>
</html>
